'''
Created on Dec 11, 2017

@author: Piyawat Pemwattana
'''

import csv
import json
import os
import pandas as pd
import sys, getopt, pprint
from pymongo import MongoClient

BASEDIR = os.path.dirname(os.path.realpath(__file__)) + '\\csv-file\\'

# csvList = [ "movies.csv",
#             "users.csv",
#              "ratings.csv",
#               "links.csv",
#                "tags.csv"]
# 
# 
# 
# mongo_client=MongoClient() 
# db=mongo_client.recommendation_system

#CSV to JSON Conversion
# for csvFile in csvList:
#     csv_file = open(BASEDIR+'\\csv-file\\'+csvFile, 'r', encoding="utf-8")
#     reader = csv.DictReader(csv_file)
# #     if csvFile is "movies.csv":
# #         db.movies.drop()
# #         header = [ "movieId", "title", "genres"]
# #     elif csvFile is "users.csv":
# #         db.users.drop()
# #         header = [ "userId", "username", "password", "timestamp"]
#     if csvFile is "ratings.csv":
#         db.ratings.drop()
#         header = [ "userId", "movieId", "rating", "timestamp"]
#         
#     for each in reader:
#         row={}
#         if header:
#             for field in header:
#                 row[field]=each[field]
#             if csvFile is "movies.csv":
#                 db.movies.insert(row)
#             elif csvFile is "users.csv":
#                 db.users.insert(row)
#             elif csvFile is "ratings.csv":
#                 db.ratings.insert(row)


mongo_client=MongoClient() 
db=mongo_client.recommendation_system


# Movies
movies_csv_file = open(BASEDIR+'movies.csv', 'r', encoding="utf8")
reader_movies = csv.DictReader(movies_csv_file)
db.movies.drop()
header_movies = [ "movieId", "title", "genres"]
try:
    for each in reader_movies:
        row={}
        for field in header_movies:
            row[field]=each[field]
    
        db.movies.insert(row)
    print("Movies Success!!")
except:
    print("Movies UnSuccess!! Because : "+ sys.exc_info()[0])
        


# Users
users_csv_file = open(BASEDIR+'users.csv', 'r', encoding="utf8")
reader_users = csv.DictReader(users_csv_file)
db.movies.drop()
header_users = [ "userId", "username", "password", "timestamp"]

try:
    for each in reader_users:
        row={}
        for field in header_users:
            row[field]=each[field]
    
        db.users.insert(row)
    print("Users Success!!")
except:
    print("Users UnSuccess!! Because : ", sys.exc_info())


# Ratings
users_csv_file = open(BASEDIR+'ratings.csv', 'r', encoding="utf8")
reader_users = csv.DictReader(users_csv_file)
db.movies.drop()
header_users = [ "userId", "username", "password", "timestamp"]

try:
    for each in reader_users:
        row={}
        for field in header_users:
            row[field]=each[field]
    
        db.users.insert(row)
    print("Users Success!!")
except:
    print("Users UnSuccess!! Because : ", sys.exc_info())